# V3: Optimized for 70%+ win rate
# Based on successful V2 results (62% WR, 107% profit)

data:
  source: alpaca
  folder: Data
  symbol: BTC
  timeframe_base: 5m
  alpaca:
    asset_class: crypto
    exchange: us
    start: "2020-01-01"
    end: "2025-11-26"
    limit: 10000

timeframes:
  h4: 240
  h1: 60
  m30: 30

strategy:
  strategy_type: crypto_momo
  
  risk_percent: 5.5
  risk_percent_low_vol: 2.0
  
  use_daily_trend_filter: true
  allow_daily_range_trades: true
  daily_trend_fast: 50
  daily_trend_slow: 200
  daily_trend_range_threshold: 0.15
  require_killzone_filter: false
  session_filter:
    - london
    - new_york
    - asia
  killzones:
    asia:
      start: "00:00"
      end: "03:00"
    london:
      start: "07:00"
      end: "11:00"
    new_york:
      start: "13:00"
      end: "17:00"

  orb_bars: 12
  orb_start_hour: 13
  orb_start_minute: 30
  orb_end_hour: 14
  orb_end_minute: 30
  only_trade_after_14utc: false
  require_atr_expansion: false
  momentum_period: 5
  min_momentum: 0.0
  max_trades_per_day: 5
  
  atr_period: 14
  # EVEN SMALLER TP for higher win rate
  tp_atr_mult: 1.0    # Down from 1.5
  sl_atr_mult: 2.0    # Up from 1.8 - wider stops
  label_window: 200
  
  use_trailing_stop: true
  trailing_stop_atr: 0.8  # Tighter trailing
  trailing_start_profit: 0.7  # Earlier trailing
  
  breakeven_trigger_r: 0.8  # Earlier BE
  partial_close_15r: 0.3
  partial_close_2r: 0.3
  
  model_threshold: 0.50
  entry_type_filter: both
  
  h4_swing_lookback: 60
  inducement_lookback: 6
  fvg_lookback: 10
  ob_lookback: 20
  require_discount_premium: false
  require_inducement: false
  require_rsi_filter: false
  require_adx_filter: false
  require_bull_only: false
  require_liquidity_sweep: false
  liquidity_sweep_lookback: 18
  liquidity_sweep_tolerance: 0.0015
  require_displacement: true
  displacement_min_atr: 0.9
  low_vol_ratio: 0.7
  min_volume_zscore: -2.0

  trend_fast_period: 21
  trend_slow_period: 55

  crypto:
    breakout_lookback: 36
    breakout_buffer_pct: 0.0
    min_breakout_range_atr: 0.2
    max_breakout_range_atr: 10.0
    min_adx: 15
    min_rsi_long: 52
    max_rsi_long: 85
    max_rsi_short: 44
    min_rsi_short: 18
    min_atr_ratio: 0.6
    min_volume_zscore: -2.0
    min_trend_gap_atr: 0.1
    max_distance_atr: 3.0
    min_distance_atr: -2.0
    reversion_rsi_min_long: 32
    reversion_rsi_max_long: 58
    reversion_rsi_min_short: 42
    reversion_rsi_max_short: 70
    enable_long: true
    enable_short: true
    
    # ULTRA SMALL TP for highest win rate
    tp_atr_mult: 0.9    # Very small TP = very likely to hit
    sl_atr_mult: 1.8    # Wide SL = unlikely to be stopped
    label_window: 120
    
    min_volume_pressure: 0.85
    min_mom_composite: 0.002
    min_volatility_ratio: 0.7
    max_bb_width: 0.3
    max_range_contraction: 9.0
    min_trend_persistence: -0.2
    killzone_bias_only: false
    killzone_labels: ["london", "new_york"]
    min_liquidity_imbalance: 0.12
    
    momentum_minutes:
      fast: 45
      mid: 240
      slow: 720
    volume_minutes:
      short: 180
      long: 1440
    volatility_minutes:
      short: 120
      long: 720
    compression_minutes: 720
    
    # Regime targets - MAXIMIZE WIN RATE
    regime_tp_multipliers:
      trend: 1.0      # Small TP
      compression: 0.9
      mean_revert: 0.8
      neutral: 0.9
    regime_sl_multipliers:
      trend: 1.8      # Wide SL
      compression: 1.6
      mean_revert: 2.0  # Extra wide for reversions
      neutral: 1.7
    
    meta_feature_columns:
      - mom_composite
      - mom_imbalance
      - volume_pressure
      - volume_acceleration
      - volatility_ratio_fast
      - trend_regime_code
      - trend_persistence
      - bb_width
      - bb_zscore
      - keltner_distance
      - vwap_distance
      - return_1h
      - return_4h
      - return_1d
      - micro_trend
      - price_acceleration
      - hour_sin
      - hour_cos
      - volume_zscore
      - atr_ratio
      - liquidity_imbalance

ml:
  model_path: models/lgbm_model.pkl
  features_path: data/features.parquet
  
  lgbm:
    objective: binary
    boosting_type: gbdt
    n_estimators: 2000
    learning_rate: 0.01
    num_leaves: 15
    max_depth: 5
    min_child_samples: 50
    subsample: 0.7
    colsample_bytree: 0.7
    reg_alpha: 0.1
    reg_lambda: 2.0
    early_stopping_rounds: 100
    verbose: -1
    min_data_in_leaf: 50
    
  scale_pos_weight_mode: balanced

backtest:
  commission: 0.0004
  slippage: 0.5
  mode: normal
  
  propfirm:
    initial_capital: 6000
    max_drawdown_pct: 0.12
    per_trade_risk_pct: 0.055
    payout_cycle_days: 14

wfa:
  train_years: 4
  test_months: 6
  slide_months: 1
  min_train_samples: 100

adaptive:
  enabled: true
  threshold_grid: [0.50, 0.52, 0.55, 0.58, 0.60, 0.62]
  min_trades_per_fold: 5
  min_fold_win_rate: 0.60  # Require higher WR per fold
  skip_negative_months: false
  risk_step: 0.005
  risk_bounds:
    min: 0.02
    max: 0.06
  state_path: btc_v3_state.json
  session_guard:
    enabled: false
    win_rate_threshold: 0.55
    min_samples: 15
  filter_profiles:
    strict_killzone:
      description: "London/NY killzone only"
      session_labels: ["london", "new_york"]
      require_killzone: true
      min_displacement: 1.0
    balanced_core:
      description: "Default high-probability flow"
      session_labels: ["london", "new_york"]
      require_killzone: false
      min_displacement: 0.9

live_trading:
  enabled: false

