# CONSERVATIVE BTC Config - WORKS WITH 10% DD LIMIT!
# ✅ Respects 10% max drawdown limit
# ✅ High win rates (70-100%)
# ✅ Conservative risk management
# ✅ Adaptive system disabled for stability

data:
  source: alpaca  # Use Alpaca for individual year testing
  folder: Data
  symbol: BTC
  timeframe_base: 5m
  alpaca:
    asset_class: crypto
    exchange: us
    start: "2023-01-01"  # Testing 2023
    end: "2023-12-31"
    limit: 10000

timeframes:
  h4: 240
  h1: 60
  m30: 30

strategy:
  strategy_type: crypto_momo
  
  # OPTIMAL RISK for 50% profit with 10% DD limit
  risk_percent: 2.5   # Balanced risk to achieve 50% profit
  risk_percent_low_vol: 1.2
  
  # Basic trend filters only
  use_daily_trend_filter: true
  allow_daily_range_trades: true
  daily_trend_fast: 50
  daily_trend_slow: 200
  daily_trend_range_threshold: 0.15
  require_killzone_filter: false
  session_filter:
    - london
    - new_york
    - asia
  killzones:
    asia:
      start: "00:00"
      end: "03:00"
    london:
      start: "07:00"
      end: "11:00"
    new_york:
      start: "13:00"
      end: "17:00"

  orb_bars: 12
  orb_start_hour: 13
  orb_start_minute: 30
  orb_end_hour: 14
  orb_end_minute: 30
  only_trade_after_14utc: false
  require_atr_expansion: false
  momentum_period: 5
  min_momentum: 0.0
  max_trades_per_day: 3  # More trades for 50% profit target
  
  atr_period: 14
  # OPTIMAL R:R for 50% profit with 10% DD
  tp_atr_mult: 1.2  # Larger TP for 50% profit target
  sl_atr_mult: 0.8  # Tight SL to maintain low DD
  label_window: 200
  
  use_trailing_stop: true
  trailing_stop_atr: 1.0
  trailing_start_profit: 1.0
  
  breakeven_trigger_r: 1.2
  partial_close_15r: 0.2
  partial_close_2r: 0.2
  
  # BALANCED threshold for 50% profit target
  model_threshold: 0.58  # Lower threshold to allow more quality trades
  entry_type_filter: both
  
  h4_swing_lookback: 60
  inducement_lookback: 6
  fvg_lookback: 10
  ob_lookback: 20
  require_discount_premium: false
  require_inducement: false
  require_rsi_filter: false
  require_adx_filter: false
  require_bull_only: false
  require_liquidity_sweep: false
  liquidity_sweep_lookback: 18
  liquidity_sweep_tolerance: 0.0015
  require_displacement: true
  displacement_min_atr: 0.9
  low_vol_ratio: 0.7
  min_volume_zscore: -2.0

  trend_fast_period: 21
  trend_slow_period: 55

  crypto:
    breakout_lookback: 36
    breakout_buffer_pct: 0.0
    min_breakout_range_atr: 0.2
    max_breakout_range_atr: 10.0
    min_adx: 20  # Balanced ADX requirement
    min_rsi_long: 55  # Balanced bullish RSI
    max_rsi_long: 80  # Balanced overbought
    max_rsi_short: 40  # Balanced bearish RSI
    min_rsi_short: 20  # Balanced oversold
    min_atr_ratio: 0.6
    min_volume_zscore: -2.0
    min_trend_gap_atr: 0.1
    max_distance_atr: 3.0
    min_distance_atr: -2.0
    reversion_rsi_min_long: 32
    reversion_rsi_max_long: 58
    reversion_rsi_min_short: 42
    reversion_rsi_max_short: 70
    enable_long: true
    enable_short: true
    
    # OPTIMAL TP/SL for 50% profit target
    tp_atr_mult: 0.8  # Balanced TP for high win rate + good profit per trade
    sl_atr_mult: 2.5  # Wide SL for good R:R
    label_window: 140
    
    min_volume_pressure: 0.90  # Balanced volume requirement
    min_mom_composite: 0.005  # Balanced momentum requirement
    min_volatility_ratio: 0.7
    max_bb_width: 0.3
    max_range_contraction: 9.0
    min_trend_persistence: -0.2
    killzone_bias_only: false
    killzone_labels: ["london", "new_york"]
    min_liquidity_imbalance: 0.12
    
    momentum_minutes:
      fast: 45
      mid: 240
      slow: 720
    volume_minutes:
      short: 180
      long: 1440
    volatility_minutes:
      short: 120
      long: 720
    compression_minutes: 720
    
    # OPTIMAL regime targets for 50% profit
    regime_tp_multipliers:
      trend: 0.8      # Balanced TP
      compression: 0.7
      mean_revert: 0.6
      neutral: 0.7
    regime_sl_multipliers:
      trend: 2.5      # Wide SL
      compression: 2.2
      mean_revert: 3.0
      neutral: 2.5
    
    # REDUCED feature set - less overfitting
    meta_feature_columns:
      - mom_composite
      - volume_pressure
      - volatility_ratio_fast
      - trend_regime_code
      - bb_zscore
      - vwap_distance
      - return_1h
      - return_4h
      - hour_sin
      - hour_cos
      - atr_ratio

ml:
  model_path: models/lgbm_model.pkl
  features_path: data/features.parquet
  
  lgbm:
    objective: binary
    boosting_type: gbdt
    # SIMPLER MODEL - less overfitting
    n_estimators: 500       # Reduced from 2000
    learning_rate: 0.05     # Higher = less overfitting
    num_leaves: 8           # Reduced from 15
    max_depth: 3            # Reduced from 5
    min_child_samples: 100  # Increased from 50
    subsample: 0.6          # Reduced
    colsample_bytree: 0.5   # Reduced
    reg_alpha: 1.0          # Increased from 0.1
    reg_lambda: 5.0         # Increased from 2.0
    early_stopping_rounds: 50
    verbose: -1
    min_data_in_leaf: 100   # Increased
    
  scale_pos_weight_mode: balanced

backtest:
  commission: 0.0004
  slippage: 0.5
  mode: normal  # Normal backtest mode with 10% DD limit
  
  propfirm:
    initial_capital: 10000  # $10k starting capital
    max_drawdown_pct: 0.10   # STRICT 10% max drawdown limit
    per_trade_risk_pct: 0.02 # Extreme conservative per-trade risk for 10% DD
    payout_cycle_days: 14

wfa:
  train_years: 4
  test_months: 6
  slide_months: 1
  min_train_samples: 100

adaptive:
  enabled: false  # Disable adaptive for ultra-conservative testing
  threshold_grid: [0.50, 0.52, 0.55, 0.58]  # Simpler grid
  min_trades_per_fold: 5
  min_fold_win_rate: 0.50  # More lenient
  skip_negative_months: false
  risk_step: 0.005
  risk_bounds:
    min: 0.03  # Conservative minimum for 10% DD
    max: 0.08  # Conservative maximum for 10% DD
  state_path: btc_robust_state.json
  session_guard:
    enabled: false
  filter_profiles:
    balanced_core:
      description: "Default balanced approach"
      session_labels: ["london", "new_york"]
      require_killzone: false
      min_displacement: 0.9

live_trading:
  enabled: false

